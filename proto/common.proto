syntax = "proto3";

package blokus;

import "google/protobuf/timestamp.proto";

// ========================================
// �⺻ ���� Ÿ�Ե�
// ========================================

// �÷��̾� ����
enum PlayerColor {
  PLAYER_COLOR_NONE = 0;
  PLAYER_COLOR_BLUE = 1;
  PLAYER_COLOR_YELLOW = 2;
  PLAYER_COLOR_RED = 3;
  PLAYER_COLOR_GREEN = 4;
}

// ���� Ÿ�� (21�� �������̳�)
enum BlockType {
  BLOCK_TYPE_SINGLE = 0;
  
  // 2ĭ ����
  BLOCK_TYPE_DOMINO = 1;
  
  // 3ĭ ����
  BLOCK_TYPE_TRIO_LINE = 2;
  BLOCK_TYPE_TRIO_ANGLE = 3;
  
  // 4ĭ ���� (��Ʈ�ι̳�)
  BLOCK_TYPE_TETRO_I = 4;
  BLOCK_TYPE_TETRO_O = 5;
  BLOCK_TYPE_TETRO_T = 6;
  BLOCK_TYPE_TETRO_L = 7;
  BLOCK_TYPE_TETRO_S = 8;
  
  // 5ĭ ���� (����̳�)
  BLOCK_TYPE_PENTO_F = 9;
  BLOCK_TYPE_PENTO_I = 10;
  BLOCK_TYPE_PENTO_L = 11;
  BLOCK_TYPE_PENTO_N = 12;
  BLOCK_TYPE_PENTO_P = 13;
  BLOCK_TYPE_PENTO_T = 14;
  BLOCK_TYPE_PENTO_U = 15;
  BLOCK_TYPE_PENTO_V = 16;
  BLOCK_TYPE_PENTO_W = 17;
  BLOCK_TYPE_PENTO_X = 18;
  BLOCK_TYPE_PENTO_Y = 19;
  BLOCK_TYPE_PENTO_Z = 20;
}

// ���� ȸ�� ����
enum Rotation {
  ROTATION_0 = 0;    // 0��
  ROTATION_90 = 1;   // 90�� �ð����
  ROTATION_180 = 2;  // 180��
  ROTATION_270 = 3;  // 270�� �ð����
}

// ���� ������ ����
enum FlipState {
  FLIP_NORMAL = 0;      // ����
  FLIP_HORIZONTAL = 1;  // ���� ������
  FLIP_VERTICAL = 2;    // ���� ������
  FLIP_BOTH = 3;        // ���� ������
}

// ���� ����
enum GameState {
  GAME_STATE_WAITING = 0;   // �÷��̾� ��� ��
  GAME_STATE_PLAYING = 1;   // ���� ���� ��
  GAME_STATE_FINISHED = 2;  // ���� ����
  GAME_STATE_PAUSED = 3;    // �Ͻ�����
}

// ����� ����
enum UserStatus {
  USER_STATUS_OFFLINE = 0;
  USER_STATUS_ONLINE = 1;
  USER_STATUS_IN_LOBBY = 2;
  USER_STATUS_IN_GAME = 3;
  USER_STATUS_AWAY = 4;
}

// ========================================
// �⺻ ������ ����
// ========================================

// 2D ��ġ
message Position {
  int32 row = 1;
  int32 col = 2;
}

// ���� ��ġ ����
message BlockPlacement {
  BlockType type = 1;
  Position position = 2;
  Rotation rotation = 3;
  FlipState flip = 4;
  PlayerColor player = 5;
}

// ����� �⺻ ����
message UserInfo {
  string username = 1;
  int32 level = 2;
  int32 total_games = 3;
  int32 wins = 4;
  int32 losses = 5;
  int32 rating = 6;
  UserStatus status = 7;
  google.protobuf.Timestamp last_seen = 8;
}

// �÷��̾� ���� ����
message PlayerSlot {
  PlayerColor color = 1;
  string username = 2;
  bool is_host = 3;
  bool is_ready = 4;
  int32 score = 5;
  int32 remaining_blocks = 6;
  repeated BlockType used_blocks = 7;
}

// �� �⺻ ����
message RoomInfo {
  int32 room_id = 1;
  string room_name = 2;
  string host_username = 3;
  int32 current_players = 4;
  int32 max_players = 5;
  bool is_private = 6;
  bool is_playing = 7;
  string game_mode = 8;  // "Ŭ����", "���" ��
  google.protobuf.Timestamp created_at = 9;
}

// ���� ���� ���� (����� ����)
message BoardState {
  // 20x20 ���带 ȿ�������� ���ڵ�
  // �� ���� 4��Ʈ (0-4: PlayerColor)
  // 400�� �� 200����Ʈ�� ����
  bytes compressed_board = 1;
  int32 board_version = 2;  // ���� ���� (�浹 ������)
}

// ���� ���
message GameStats {
  int32 total_moves = 1;
  int32 game_duration_seconds = 2;
  map<string, int32> player_scores = 3;
  map<string, int32> blocks_used = 4;
  string winner = 5;
}

// ���� ���� ����
message ServerInfo {
  int32 online_users = 1;
  int32 active_rooms = 2;
  int32 ongoing_games = 3;
  float server_load = 4;
  string server_version = 5;
  google.protobuf.Timestamp server_time = 6;
}

// ========================================
// ���� ��� Ÿ��
// ========================================

// ����/���� ���
enum ResultCode {
  RESULT_SUCCESS = 0;
  RESULT_UNKNOWN_ERROR = 1;
  RESULT_INVALID_REQUEST = 2;
  RESULT_PERMISSION_DENIED = 3;
  RESULT_NOT_FOUND = 4;
  RESULT_ALREADY_EXISTS = 5;
  RESULT_GAME_RULE_VIOLATION = 6;
  RESULT_TIMEOUT = 7;
  RESULT_SERVER_BUSY = 8;
}

// ���� ���� ���
message Result {
  ResultCode code = 1;
  string message = 2;
  map<string, string> details = 3;  // �߰� ����
}