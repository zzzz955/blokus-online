syntax = "proto3";

package blokus;

import "google/protobuf/any.proto";
import "google/protobuf/timestamp.proto";

// ========================================
// �޽��� Ÿ�� ������ (����ÿ�)
// ========================================

enum MessageType {
  // �⺻ �޽���
  MESSAGE_TYPE_UNKNOWN = 0;
  
  // ���� �� ���� (100-199)
  MESSAGE_TYPE_AUTH_REQUEST = 100;
  MESSAGE_TYPE_AUTH_RESPONSE = 101;
  MESSAGE_TYPE_REGISTER_REQUEST = 102;
  MESSAGE_TYPE_REGISTER_RESPONSE = 103;
  MESSAGE_TYPE_LOGOUT_REQUEST = 104;
  MESSAGE_TYPE_LOGOUT_RESPONSE = 105;
  MESSAGE_TYPE_HEARTBEAT = 106;
  MESSAGE_TYPE_WELCOME = 107;
  
  // �κ� �ý��� (200-299)
  MESSAGE_TYPE_GET_ROOM_LIST_REQUEST = 200;
  MESSAGE_TYPE_ROOM_LIST_RESPONSE = 201;
  MESSAGE_TYPE_ROOM_LIST_UPDATE = 202;
  MESSAGE_TYPE_CREATE_ROOM_REQUEST = 203;
  MESSAGE_TYPE_CREATE_ROOM_RESPONSE = 204;
  MESSAGE_TYPE_JOIN_ROOM_REQUEST = 205;
  MESSAGE_TYPE_JOIN_ROOM_RESPONSE = 206;
  MESSAGE_TYPE_LEAVE_ROOM_REQUEST = 207;
  MESSAGE_TYPE_LEAVE_ROOM_RESPONSE = 208;
  MESSAGE_TYPE_PLAYER_JOINED_NOTIFICATION = 209;
  MESSAGE_TYPE_PLAYER_LEFT_NOTIFICATION = 210;
  MESSAGE_TYPE_USER_LIST_UPDATE = 211;
  MESSAGE_TYPE_GET_USER_STATS_REQUEST = 212;
  MESSAGE_TYPE_USER_STATS_RESPONSE = 213;
  
  // ���� �� ���� (300-349)
  MESSAGE_TYPE_ROOM_STATE_UPDATE = 300;
  MESSAGE_TYPE_REMOVE_PLAYER_REQUEST = 301;
  MESSAGE_TYPE_REMOVE_PLAYER_RESPONSE = 302;
  MESSAGE_TYPE_KICK_PLAYER_REQUEST = 303;
  MESSAGE_TYPE_KICK_PLAYER_RESPONSE = 304;
  MESSAGE_TYPE_PLAYER_READY_REQUEST = 305;
  MESSAGE_TYPE_PLAYER_READY_RESPONSE = 306;
  MESSAGE_TYPE_START_GAME_REQUEST = 307;
  MESSAGE_TYPE_START_GAME_RESPONSE = 308;
  
  // �����÷��� (350-399)
  MESSAGE_TYPE_GAME_STARTED_NOTIFICATION = 350;
  MESSAGE_TYPE_TURN_CHANGED_NOTIFICATION = 351;
  MESSAGE_TYPE_PLACE_BLOCK_REQUEST = 352;
  MESSAGE_TYPE_PLACE_BLOCK_RESPONSE = 353;
  MESSAGE_TYPE_BLOCK_PLACED_NOTIFICATION = 354;
  MESSAGE_TYPE_GAME_STATE_UPDATE = 355;
  MESSAGE_TYPE_SKIP_TURN_REQUEST = 356;
  MESSAGE_TYPE_SKIP_TURN_RESPONSE = 357;
  MESSAGE_TYPE_GAME_ENDED_NOTIFICATION = 358;
  MESSAGE_TYPE_GET_GAME_STATE_REQUEST = 359;
  MESSAGE_TYPE_GAME_STATE_RESPONSE = 360;
  MESSAGE_TYPE_UNDO_MOVE_REQUEST = 361;
  MESSAGE_TYPE_UNDO_MOVE_RESPONSE = 362;
  
  // ä�� �ý��� (400-449)
  MESSAGE_TYPE_CHAT_MESSAGE = 400;
  MESSAGE_TYPE_CHAT_NOTIFICATION = 401;
  MESSAGE_TYPE_WHISPER_MESSAGE = 402;
  MESSAGE_TYPE_SYSTEM_MESSAGE = 403;
  MESSAGE_TYPE_CHAT_HISTORY_REQUEST = 404;
  MESSAGE_TYPE_CHAT_HISTORY_RESPONSE = 405;
  
  // ������ ��� (450-499)
  MESSAGE_TYPE_ADMIN_COMMAND = 450;
  MESSAGE_TYPE_ADMIN_RESPONSE = 451;
  MESSAGE_TYPE_SERVER_ANNOUNCEMENT = 452;
  MESSAGE_TYPE_MAINTENANCE_NOTIFICATION = 453;
  
  // ��� �� ��ŷ (500-549)
  MESSAGE_TYPE_GET_RANKING_REQUEST = 500;
  MESSAGE_TYPE_RANKING_RESPONSE = 501;
  MESSAGE_TYPE_RANKING_UPDATE = 502;
  MESSAGE_TYPE_GAME_REPLAY_REQUEST = 503;
  MESSAGE_TYPE_GAME_REPLAY_RESPONSE = 504;
  MESSAGE_TYPE_ACHIEVEMENT_UNLOCKED = 505;
  
  // ���� �� Ư�� (900-999)
  MESSAGE_TYPE_ERROR_RESPONSE = 900;
  MESSAGE_TYPE_RATE_LIMIT_EXCEEDED = 901;
  MESSAGE_TYPE_SERVER_SHUTDOWN = 902;
  MESSAGE_TYPE_RECONNECT_REQUEST = 903;
  MESSAGE_TYPE_RECONNECT_RESPONSE = 904;
  MESSAGE_TYPE_PING = 905;
  MESSAGE_TYPE_PONG = 906;
}

// ========================================
// �޽��� �켱���� (QoS)
// ========================================

enum MessagePriority {
  PRIORITY_LOW = 0;      // ���, ä�� ��
  PRIORITY_NORMAL = 1;   // �κ� ������Ʈ, �Ϲ� �˸�
  PRIORITY_HIGH = 2;     // ���� ���� ����
  PRIORITY_CRITICAL = 3; // ���� ��ġ, �� ����
}

// ========================================
// �޽��� ����
// ========================================

message MessageWrapper {
  // �⺻ ����� ����
  MessageType type = 1;
  uint32 sequence_id = 2;          // ��û-���� ��Ī��
  google.protobuf.Any payload = 3;  // ���� �޽��� ������
  
  // ��Ÿ������
  google.protobuf.Timestamp timestamp = 10;
  string client_version = 11;
  MessagePriority priority = 12;
  
  // ����� ����
  string target_room = 15;         // Ư�� ������ ����
  string target_user = 16;         // Ư�� ����ڿ��� ����
  bool broadcast = 17;             // ��ü ��ε�ĳ��Ʈ
  
  // ���� �ɼ�
  bool requires_ack = 20;          // ���� Ȯ�� �ʿ�
  uint32 retry_count = 21;         // ��õ� Ƚ��
  uint32 timeout_ms = 22;          // Ÿ�Ӿƿ� (�и���)
  
  // ���� �� ����ȭ
  bool compressed = 25;            // ���̷ε� ���� ����
  string compression_type = 26;    // "gzip", "lz4" ��
  
  // ����� �� ����
  string trace_id = 30;           // �л� ������ ID
  map<string, string> headers = 31; // Ŀ���� ���
}

// ========================================
// �޽��� Ȯ�� ����
// ========================================

message MessageAck {
  uint32 sequence_id = 1;
  bool success = 2;
  string error_message = 3;
  google.protobuf.Timestamp received_at = 4;
}

// ========================================
// ��ġ �޽��� (���� �޽����� ��� ����)
// ========================================

message BatchMessage {
  repeated MessageWrapper messages = 1;
  uint32 batch_id = 2;
  google.protobuf.Timestamp created_at = 3;
  bool ordered = 4;  // ���� ���� �ʿ� ����
}

// ========================================
// ���� ���� ����
// ========================================

message KeepAlive {
  google.protobuf.Timestamp timestamp = 1;
  uint32 client_fps = 2;           // Ŭ���̾�Ʈ ���� ����͸�
  float network_latency_ms = 3;    // ��Ʈ��ũ �����ð�
  uint32 memory_usage_mb = 4;      // �޸� ��뷮
}

message ConnectionStatus {
  enum Status {
    CONNECTED = 0;
    DISCONNECTED = 1;
    RECONNECTING = 2;
    TIMEOUT = 3;
  }
  
  Status status = 1;
  string reason = 2;
  google.protobuf.Timestamp last_activity = 3;
  uint32 missed_heartbeats = 4;
}

// ========================================
// ���� ����
// ========================================

message SessionInfo {
  string session_token = 1;
  string username = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp last_activity = 4;
  int32 current_room_id = 5;
  uint32 last_message_sequence = 6;
}

message ReconnectInfo {
  SessionInfo session = 1;
  uint32 missed_message_count = 2;
  repeated MessageWrapper missed_messages = 3;
  bool full_state_required = 4;  // ��ü ���� ������ �ʿ�
}

// ========================================
// �޽��� ��� �� ����͸�
// ========================================

message MessageStats {
  MessageType type = 1;
  uint64 sent_count = 2;
  uint64 received_count = 3;
  uint64 error_count = 4;
  float average_latency_ms = 5;
  uint64 total_bytes = 6;
  google.protobuf.Timestamp last_sent = 7;
}

message NetworkStats {
  repeated MessageStats message_stats = 1;
  uint64 total_messages_sent = 2;
  uint64 total_messages_received = 3;
  uint64 total_bytes_sent = 4;
  uint64 total_bytes_received = 5;
  float average_latency_ms = 6;
  uint32 connection_drops = 7;
  google.protobuf.Timestamp session_start = 8;
}