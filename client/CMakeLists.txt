cmake_minimum_required(VERSION 3.24)

project(BlokusClient VERSION 1.0.0 LANGUAGES CXX)

# C++ í‘œì¤€ ì„¤ì •
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Qt ì„¤ì •
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# MSVC UTF-8 ì¸ì½”ë”© ê°•ì œ ì„¤ì • (ë””ë²„ê·¸ ë¬¸ì œ í•´ê²°)
if(MSVC)
    add_compile_options(/utf-8)
    add_compile_options(/wd4828)  # C4828 ê²½ê³  ë¬´ì‹œ
    add_compile_definitions(_CRT_SECURE_NO_WARNINGS)
    # í•œê¸€ ì½˜ì†” ì¶œë ¥ì„ ìœ„í•œ ì„¤ì •
    add_compile_definitions(UNICODE _UNICODE)
endif()

# vcpkg íŒ¨í‚¤ì§€ ì°¾ê¸°
find_package(Qt5 REQUIRED COMPONENTS Core Widgets Gui Svg Network)
find_package(spdlog CONFIG REQUIRED)
find_package(nlohmann_json CONFIG REQUIRED)

# ì†ŒìŠ¤ íŒŒì¼ë“¤
set(SOURCES
    src/main.cpp
    src/ui/GameBoard.cpp
    src/ui/MainWindow.cpp
    src/ui/ImprovedBlockPalette.cpp    # ê°œì„ ëœ 4ë°©í–¥ ë¸”ë¡ íŒ”ë ˆíŠ¸
    src/ui/LoginWindow.cpp             # ğŸ†• ë¡œê·¸ì¸ í™”ë©´
    src/ui/LobbyWindow.cpp             # ğŸ†• ë¡œë¹„ í™”ë©´
    src/game/Block.cpp                 # ë¸”ë¡ ì‹œìŠ¤í…œ
    src/game/GameLogic.cpp             # ê²Œì„ ë¡œì§ ë° ê·œì¹™
)

# í—¤ë” íŒŒì¼ë“¤
set(HEADERS
    include/ui/GameBoard.h
    include/ui/MainWindow.h
    include/ui/ImprovedBlockPalette.h  # ê°œì„ ëœ ë¸”ë¡ íŒ”ë ˆíŠ¸ í—¤ë”
    include/ui/LoginWindow.h           # ğŸ†• ë¡œê·¸ì¸ í™”ë©´ í—¤ë”
    include/ui/LobbyWindow.h           # ğŸ†• ë¡œë¹„ í™”ë©´ í—¤ë”
    include/common/Types.h
    include/game/Block.h               # ë¸”ë¡ í—¤ë”
    include/game/GameLogic.h           # ê²Œì„ ë¡œì§ í—¤ë”
)

# ì‹¤í–‰ íŒŒì¼ ìƒì„±
add_executable(BlokusClient ${SOURCES} ${HEADERS})

# í¬í•¨ ë””ë ‰í† ë¦¬
target_include_directories(BlokusClient PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§í¬
target_link_libraries(BlokusClient
    Qt5::Core
    Qt5::Widgets
    Qt5::Gui
    Qt5::Svg
    Qt5::Network
    spdlog::spdlog
    nlohmann_json::nlohmann_json
)

# Windows íŠ¹ì • ì„¤ì •
if(WIN32)
    set_target_properties(BlokusClient PROPERTIES
        WIN32_EXECUTABLE TRUE
    )
    
    # ì½˜ì†” ì°½ë„ í•¨ê»˜ í‘œì‹œ (ë””ë²„ê¹…ìš©)
    if(CMAKE_BUILD_TYPE STREQUAL "Debug")
        set_target_properties(BlokusClient PROPERTIES
            LINK_FLAGS "/SUBSYSTEM:CONSOLE"
        )
    endif()
endif()

# ì»´íŒŒì¼ëŸ¬ í”Œë˜ê·¸
if(MSVC)
    target_compile_options(BlokusClient PRIVATE 
        /W4        # ê²½ê³  ë ˆë²¨ 4
        /utf-8     # UTF-8 ì¸ì½”ë”© ê°•ì œ
        /permissive-  # í‘œì¤€ ì¤€ìˆ˜ ëª¨ë“œ
    )
else()
    target_compile_options(BlokusClient PRIVATE 
        -Wall -Wextra -pedantic
        -finput-charset=UTF-8 
        -fexec-charset=UTF-8
    )
endif()

# ë””ë²„ê·¸ ì •ë³´ ì¶”ê°€
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    target_compile_definitions(BlokusClient PRIVATE DEBUG _DEBUG)
    message(STATUS "ë””ë²„ê·¸ ëª¨ë“œ: ë¡œê·¸ì¸ ì‹œìŠ¤í…œ + ë¸”ë¡ ë Œë”ë§ ì‹œìŠ¤í…œ í¬í•¨")
endif()

# ë¹Œë“œ ì •ë³´ ì¶œë ¥
message(STATUS "=== ë¸”ë¡œì»¤ìŠ¤ í´ë¼ì´ì–¸íŠ¸ ë¹Œë“œ ì •ë³´ ===")
message(STATUS "ë²„ì „: ${PROJECT_VERSION}")
message(STATUS "ë¡œê·¸ì¸ ì‹œìŠ¤í…œ: í™œì„±í™”")
message(STATUS "ë¡œë¹„ ì‹œìŠ¤í…œ: í™œì„±í™”")
message(STATUS "ë¸”ë¡ ì‹œìŠ¤í…œ: í™œì„±í™”")
message(STATUS "ì´ ì†ŒìŠ¤ íŒŒì¼: ${SOURCES}")
message(STATUS "========================================")